<HTML>
<head>
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600|Lato:400,700&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: 'IBM Plex Sans', Lato, Arial, sans-serif; background: #f8f9fa; }
.dashboard-container { max-width: 1200px; margin: 0 auto; padding: 32px; }
.header { color: #222222; font-size: 2.2em; font-weight: bold; margin-bottom: 0.2em; }
.subheader { color: #555; font-size: 1.1em; margin-bottom: 1.5em; }
.card { background: #fff; border-radius: 14px; box-shadow: 0 2px 8px #e0e0e0; padding: 22px; margin-bottom: 32px; }
.flex-row { display: flex; flex-wrap: wrap; gap: 32px; }
.flex-col { flex: 1 1 400px; min-width: 350px; max-width: 600px; }
.toggle-group { margin-bottom: 18px; }
.toggle-group label { font-weight: 600; color: #333; margin-right: 12px; }
.toggle-btn, .dropdown { font-size: 1em; padding: 7px 18px; border-radius: 7px; border: 1px solid #ccc; margin-right: 10px; background: #f5f5f5; cursor: pointer; }
.toggle-btn.selected { background: #766CDB; color: #fff; border-color: #766CDB; }
.table { width: 100%; border-collapse: collapse; margin-top: 10px; }
.table th, .table td { padding: 8px 12px; border-bottom: 1px solid #eee; text-align: left; }
.table th { background: #f3f3f3; color: #333; font-weight: 600; }
.table-striped tr:nth-child(even) { background: #fafaff; }
.kpi { font-size: 1.1em; color: #333; margin: 8px 0; }
@media (max-width: 900px) { .flex-row { flex-direction: column; } .flex-col { max-width: 100%; } }
</style>
</head>
<body>
<div class="dashboard-container">
  <div class="header">Lionshead Supply Chain Interactive Dashboard</div>
  <div class="subheader">Explore facility performance, network KPIs, and optimization impact. Use the toggles below to filter by scenario, region, and facility.</div>
  <div class="toggle-group">
    <label>Scenario:</label>
    <button class="toggle-btn selected" id="btn-current">Current</button>
    <button class="toggle-btn" id="btn-zeus">Zeus AI</button>
    <label style="margin-left:30px;">Region:</label>
    <select class="dropdown" id="region-dropdown"></select>
    <label style="margin-left:30px;">Facility:</label>
    <select class="dropdown" id="facility-dropdown"></select>
  </div>
  <div class="flex-row">
    <div class="flex-col card">
      <h2 style="font-size: 1.2em; color: #333; font-weight: 600; margin-bottom: 0.5em;">Facility Network Map</h2>
      <div id="network-map" style="height: 600px;"></div>
    </div>
    <div class="flex-col card">
      <h2 style="font-size: 1.2em; color: #333; font-weight: 600; margin-bottom: 0.5em;">Trailer Fill Rate</h2>
      <div id="fill-bar" style="height: 220px;"></div>
      <h2 style="font-size: 1.2em; color: #333; font-weight: 600; margin-top: 1.2em; margin-bottom: 0.5em;">Empty Miles</h2>
      <div id="empty-bar" style="height: 220px;"></div>
    </div>
  </div>
  <div class="card">
    <h2 style="font-size: 1.2em; color: #333; font-weight: 600; margin-bottom: 0.5em;">Facility KPIs Table</h2>
    <div id="kpi-table"></div>
  </div>
  <div style="margin-top: 2em; color: #888; font-size: 0.95em;">Dashboard generated by Julius AI | <a href='https://julius.ai' style='color:#766CDB;'>julius.ai</a></div>
</div>
<script>
// Data injected from Python
const facilities = JSON.parse(`[
  {
    "name": "Goshen_IN_HQ",
    "display_name": "Goshen IN HQ",
    "lat": 41.5823,
    "lon": -85.8344,
    "sqft": 200000,
    "region": "Midwest",
    "type": "HQ_Primary_DC",
    "weekly_shipments": 20576,
    "current_fill_rate": 69.2,
    "zeus_fill_rate": 90.2,
    "current_empty_miles": 16.2,
    "zeus_empty_miles": 3.3,
    "current_trailers": 52,
    "zeus_trailers": 58,
    "annual_savings": -624000
  },
  {
    "name": "Middlebury_IN",
    "display_name": "Middlebury IN",
    "lat": 41.677,
    "lon": -85.7055,
    "sqft": 150000,
    "region": "Midwest",
    "type": "Assembly_Distribution",
    "weekly_shipments": 8206,
    "current_fill_rate": 67.1,
    "zeus_fill_rate": 89.8,
    "current_empty_miles": 17.9,
    "zeus_empty_miles": 4.4,
    "current_trailers": 21,
    "zeus_trailers": 23,
    "annual_savings": -208000
  },
  {
    "name": "Paris_TX",
    "display_name": "Paris TX",
    "lat": 33.6609,
    "lon": -95.5555,
    "sqft": 120000,
    "region": "South Central",
    "type": "Regional_Hub",
    "weekly_shipments": 18475,
    "current_fill_rate": 66.1,
    "zeus_fill_rate": 86.7,
    "current_empty_miles": 19.3,
    "zeus_empty_miles": 4.9,
    "current_trailers": 53,
    "zeus_trailers": 61,
    "annual_savings": -832000
  },
  {
    "name": "Norwood_Young_America_MN",
    "display_name": "Norwood Young America MN",
    "lat": 44.7774,
    "lon": -93.9219,
    "sqft": 180000,
    "region": "Midwest",
    "type": "Assembly_Distribution",
    "weekly_shipments": 11489,
    "current_fill_rate": 67.0,
    "zeus_fill_rate": 87.8,
    "current_empty_miles": 19.4,
    "zeus_empty_miles": 3.7,
    "current_trailers": 14,
    "zeus_trailers": 16,
    "annual_savings": -208000
  },
  {
    "name": "Nashville_GA",
    "display_name": "Nashville GA",
    "lat": 31.2077,
    "lon": -83.2479,
    "sqft": 160000,
    "region": "Southeast",
    "type": "Southeast_Hub",
    "weekly_shipments": 5456,
    "current_fill_rate": 69.5,
    "zeus_fill_rate": 88.3,
    "current_empty_miles": 16.2,
    "zeus_empty_miles": 3.0,
    "current_trailers": 29,
    "zeus_trailers": 33,
    "annual_savings": -416000
  },
  {
    "name": "Mountain_Home_ID",
    "display_name": "Mountain Home ID",
    "lat": 43.1329,
    "lon": -115.6915,
    "sqft": 140000,
    "region": "Northwest",
    "type": "Assembly_Distribution",
    "weekly_shipments": 20873,
    "current_fill_rate": 65.7,
    "zeus_fill_rate": 85.6,
    "current_empty_miles": 19.5,
    "zeus_empty_miles": 2.1,
    "current_trailers": 47,
    "zeus_trailers": 54,
    "annual_savings": -728000
  },
  {
    "name": "Thomasville_NC",
    "display_name": "Thomasville NC",
    "lat": 35.8826,
    "lon": -80.0817,
    "sqft": 170000,
    "region": "Unknown",
    "type": "Assembly_Distribution",
    "weekly_shipments": 7734,
    "current_fill_rate": 67.6,
    "zeus_fill_rate": 88.7,
    "current_empty_miles": 18.0,
    "zeus_empty_miles": 4.8,
    "current_trailers": 20,
    "zeus_trailers": 22,
    "annual_savings": -208000
  }
]`);
const oems = JSON.parse(`[
  {
    "name": "OEM_1",
    "lat": 44.91803916671186,
    "lon": -93.71214827649219,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1147
  },
  {
    "name": "OEM_2",
    "lat": 39.21895519963455,
    "lon": -88.13673399917795,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 2177
  },
  {
    "name": "OEM_3",
    "lat": 30.445081872235406,
    "lon": -81.09757848047828,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 695
  },
  {
    "name": "OEM_4",
    "lat": 35.465714008905344,
    "lon": -78.54434348512676,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 1263
  },
  {
    "name": "OEM_5",
    "lat": 41.413442258991616,
    "lon": -85.94518910042665,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1862
  },
  {
    "name": "OEM_6",
    "lat": 31.898910102683956,
    "lon": -117.07267831566242,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 789
  },
  {
    "name": "OEM_7",
    "lat": 45.415744562267506,
    "lon": -83.62211933475925,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 1335
  },
  {
    "name": "OEM_8",
    "lat": 43.13272552278465,
    "lon": -84.34063139808909,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 636
  },
  {
    "name": "OEM_9",
    "lat": 33.524469692147534,
    "lon": -80.3806251161968,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 1379
  },
  {
    "name": "OEM_10",
    "lat": 43.6346298196607,
    "lon": -87.42991908538524,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 968
  },
  {
    "name": "OEM_11",
    "lat": 30.50437253488263,
    "lon": -111.18077119113846,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1294
  },
  {
    "name": "OEM_12",
    "lat": 44.018175208160464,
    "lon": -92.9650674429805,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1124
  },
  {
    "name": "OEM_13",
    "lat": 40.1551577502933,
    "lon": -84.91072963296286,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1478
  },
  {
    "name": "OEM_14",
    "lat": 41.71989697754477,
    "lon": -86.02456249956096,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1416
  },
  {
    "name": "OEM_15",
    "lat": 34.90660641817175,
    "lon": -95.0297795848742,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1866
  },
  {
    "name": "OEM_16",
    "lat": 43.94298321676948,
    "lon": -83.58844548815217,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 1472
  },
  {
    "name": "OEM_17",
    "lat": 38.54171235868144,
    "lon": -85.30647690204475,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 2496
  },
  {
    "name": "OEM_18",
    "lat": 33.9209251500519,
    "lon": -82.70502968354015,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 1480
  },
  {
    "name": "OEM_19",
    "lat": 40.821643451949434,
    "lon": -85.92420813283108,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1261
  },
  {
    "name": "OEM_20",
    "lat": 39.18071293030511,
    "lon": -88.7346780132133,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1795
  },
  {
    "name": "OEM_21",
    "lat": 39.61401881827449,
    "lon": -106.69648413730287,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1479
  },
  {
    "name": "OEM_22",
    "lat": 38.17840376032453,
    "lon": -86.69339274747267,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1928
  },
  {
    "name": "OEM_23",
    "lat": 34.406059074521686,
    "lon": -115.04766339625455,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 941
  },
  {
    "name": "OEM_24",
    "lat": 43.89552220793733,
    "lon": -85.60852988474315,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 996
  },
  {
    "name": "OEM_25",
    "lat": 43.77613152529938,
    "lon": -91.90070129023714,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1298
  },
  {
    "name": "OEM_26",
    "lat": 35.181703240448,
    "lon": -76.26980627755677,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 618
  },
  {
    "name": "OEM_27",
    "lat": 33.28029902903119,
    "lon": -97.62381723484265,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1176
  },
  {
    "name": "OEM_28",
    "lat": 44.65557193922955,
    "lon": -93.84569448935885,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1211
  },
  {
    "name": "OEM_29",
    "lat": 42.34146170026983,
    "lon": -94.76263545345336,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 995
  },
  {
    "name": "OEM_30",
    "lat": 40.27661863303304,
    "lon": -113.58388196146538,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1044
  },
  {
    "name": "OEM_31",
    "lat": 31.5621982474123,
    "lon": -97.13105504666765,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1232
  },
  {
    "name": "OEM_32",
    "lat": 43.59209968183324,
    "lon": -105.33184926591518,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 675
  },
  {
    "name": "OEM_33",
    "lat": 43.19157088057744,
    "lon": -86.46544304349874,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 864
  },
  {
    "name": "OEM_34",
    "lat": 46.52832123463937,
    "lon": -117.42979493742365,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1054
  },
  {
    "name": "OEM_35",
    "lat": 37.85721264576808,
    "lon": -95.65429398570281,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1795
  },
  {
    "name": "OEM_36",
    "lat": 33.33244558121213,
    "lon": -86.3052346888472,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 1317
  },
  {
    "name": "OEM_37",
    "lat": 43.10152526156571,
    "lon": -115.71629113607437,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1334
  },
  {
    "name": "OEM_38",
    "lat": 41.19118939319161,
    "lon": -115.51550637204232,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 983
  },
  {
    "name": "OEM_39",
    "lat": 31.99072929551487,
    "lon": -119.18660863730156,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1163
  },
  {
    "name": "OEM_40",
    "lat": 44.462643697294794,
    "lon": -114.80390257891446,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1450
  },
  {
    "name": "OEM_41",
    "lat": 39.234792172221844,
    "lon": -88.37035713879723,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 1343
  },
  {
    "name": "OEM_42",
    "lat": 33.640586015837606,
    "lon": -95.45174838646065,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1884
  },
  {
    "name": "OEM_43",
    "lat": 32.01088154991983,
    "lon": -77.67936370411886,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 668
  },
  {
    "name": "OEM_44",
    "lat": 44.55269463374762,
    "lon": -103.342858488505,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 698
  },
  {
    "name": "OEM_45",
    "lat": 43.90483865793133,
    "lon": -116.71280061371317,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 995
  },
  {
    "name": "OEM_46",
    "lat": 28.311809007705172,
    "lon": -80.9926114890451,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 624
  },
  {
    "name": "OEM_47",
    "lat": 30.197074224442247,
    "lon": -110.59865770730879,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1947
  },
  {
    "name": "OEM_48",
    "lat": 35.09699528203478,
    "lon": -108.56263579186175,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1490
  },
  {
    "name": "OEM_49",
    "lat": 43.96688577225175,
    "lon": -92.93575401276394,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1068
  },
  {
    "name": "OEM_50",
    "lat": 42.77192770954608,
    "lon": -80.98174566389534,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 1083
  },
  {
    "name": "OEM_51",
    "lat": 37.69282078063594,
    "lon": -97.43176673907601,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1564
  },
  {
    "name": "OEM_52",
    "lat": 40.04938682322201,
    "lon": -88.41149052340334,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 2374
  },
  {
    "name": "OEM_53",
    "lat": 44.13009081089863,
    "lon": -104.7902179416809,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 743
  },
  {
    "name": "OEM_54",
    "lat": 34.83152063745415,
    "lon": -83.66317087832977,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 1168
  },
  {
    "name": "OEM_55",
    "lat": 33.25427312876969,
    "lon": -118.25243695067596,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 638
  },
  {
    "name": "OEM_56",
    "lat": 36.45973762846261,
    "lon": -77.43569077821284,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 708
  },
  {
    "name": "OEM_57",
    "lat": 41.736099425789746,
    "lon": -115.83505998074706,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1292
  },
  {
    "name": "OEM_58",
    "lat": 33.60414827145526,
    "lon": -100.24628606824638,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1041
  },
  {
    "name": "OEM_59",
    "lat": 44.18535638885117,
    "lon": -95.59849431514183,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 785
  },
  {
    "name": "OEM_60",
    "lat": 41.682199485130404,
    "lon": -117.40680021563038,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 997
  },
  {
    "name": "OEM_61",
    "lat": 36.40643927752415,
    "lon": -87.14823075471816,
    "assigned_facility": "Goshen_IN_HQ",
    "weekly_shipments": 2446
  },
  {
    "name": "OEM_62",
    "lat": 44.92653598332245,
    "lon": -93.78862189440558,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1233
  },
  {
    "name": "OEM_63",
    "lat": 29.151982773407806,
    "lon": -83.13950656578452,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 732
  },
  {
    "name": "OEM_64",
    "lat": 34.51963860244704,
    "lon": -96.29661409735739,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1162
  },
  {
    "name": "OEM_65",
    "lat": 43.292498667740155,
    "lon": -115.42945578441736,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 814
  },
  {
    "name": "OEM_66",
    "lat": 29.45069227920757,
    "lon": -93.64009884269416,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1732
  },
  {
    "name": "OEM_67",
    "lat": 38.78306102388994,
    "lon": -102.5323533207065,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1234
  },
  {
    "name": "OEM_68",
    "lat": 36.790299138355785,
    "lon": -95.44724448078293,
    "assigned_facility": "Paris_TX",
    "weekly_shipments": 1842
  },
  {
    "name": "OEM_69",
    "lat": 35.56374484261316,
    "lon": -76.74642462792386,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 1257
  },
  {
    "name": "OEM_70",
    "lat": 32.32844929141804,
    "lon": -116.87874146061756,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1350
  },
  {
    "name": "OEM_71",
    "lat": 46.02781486384932,
    "lon": -93.32205238430822,
    "assigned_facility": "Norwood_Young_America_MN",
    "weekly_shipments": 1187
  },
  {
    "name": "OEM_72",
    "lat": 29.39562290750904,
    "lon": -83.34891828349788,
    "assigned_facility": "Nashville_GA",
    "weekly_shipments": 608
  },
  {
    "name": "OEM_73",
    "lat": 38.17731255147467,
    "lon": -82.30621374534951,
    "assigned_facility": "Thomasville_NC",
    "weekly_shipments": 673
  },
  {
    "name": "OEM_74",
    "lat": 33.79458773371221,
    "lon": -112.01522052991247,
    "assigned_facility": "Mountain_Home_ID",
    "weekly_shipments": 1091
  },
  {
    "name": "OEM_75",
    "lat": 42.71619056754349,
    "lon": -75.4272686099697,
    "assigned_facility": "Middlebury_IN",
    "weekly_shipments": 852
  }
]`);

// Helper: get unique regions and facilities
const allRegions = Array.from(new Set(facilities.map(f => f.region))).sort();
const allFacilities = facilities.map(f => f.name);

// Populate dropdowns
function populateDropdowns() {
  const regionDropdown = document.getElementById('region-dropdown');
  regionDropdown.innerHTML = '<option value="All Regions">All Regions</option>' + allRegions.map(r => `<option value="${r}">${r}</option>`).join('');
  const facilityDropdown = document.getElementById('facility-dropdown');
  facilityDropdown.innerHTML = '<option value="All Facilities">All Facilities</option>' + facilities.map(f => `<option value="${f.name}">${f.display_name}</option>`).join('');
}

// State
let scenario = 'current';
let selectedRegion = 'All Regions';
let selectedFacility = 'All Facilities';

// Event listeners
function setupEvents() {
  document.getElementById('btn-current').onclick = function() {
    scenario = 'current';
    this.classList.add('selected');
    document.getElementById('btn-zeus').classList.remove('selected');
    updateDashboard();
  };
  document.getElementById('btn-zeus').onclick = function() {
    scenario = 'zeus';
    this.classList.add('selected');
    document.getElementById('btn-current').classList.remove('selected');
    updateDashboard();
  };
  document.getElementById('region-dropdown').onchange = function() {
    selectedRegion = this.value;
    updateDashboard();
  };
  document.getElementById('facility-dropdown').onchange = function() {
    selectedFacility = this.value;
    updateDashboard();
  };
}

// Main dashboard update
function updateDashboard() {
  // Filter facilities
  let filteredFacilities = facilities;
  if (selectedFacility !== 'All Facilities') {
    filteredFacilities = facilities.filter(f => f.name === selectedFacility);
  } else if (selectedRegion !== 'All Regions') {
    filteredFacilities = facilities.filter(f => f.region === selectedRegion);
  }

  // Map
  const mapData = [
    {
      type: 'scattermapbox',
      lat: filteredFacilities.map(f => f.lat),
      lon: filteredFacilities.map(f => f.lon),
      mode: 'markers+text',
      marker: {
        size: filteredFacilities.map(f => Math.max(18, Math.sqrt(f.weekly_shipments) * 1.2)),
        color: '#766CDB',
        opacity: 0.85,
        line: { color: '#333', width: 2 }
      },
      text: filteredFacilities.map(f => f.display_name),
      textposition: 'top center',
      hoverinfo: 'text',
      name: 'Facility'
    },
    {
      type: 'scattermapbox',
      lat: oems.filter(o => selectedFacility === 'All Facilities' || o.assigned_facility === selectedFacility).map(o => o.lat),
      lon: oems.filter(o => selectedFacility === 'All Facilities' || o.assigned_facility === selectedFacility).map(o => o.lon),
      mode: 'markers',
      marker: {
        size: 8,
        color: '#E0E0E0',
        opacity: 0.7,
        line: { color: '#666', width: 1 }
      },
      hoverinfo: 'none',
      name: 'OEM Customer'
    }
  ];
  Plotly.newPlot('network-map', mapData, {
    mapbox: {
      style: 'carto-positron',
      center: { lat: 39.5, lon: -97.5 },
      zoom: 3.5
    },
    margin: { l:0, r:0, t:30, b:0 },
    showlegend: false,
    height: 600
  }, {displayModeBar: false});

  // Bar: Trailer Fill Rate
  const fillKey = scenario === 'current' ? 'current_fill_rate' : 'zeus_fill_rate';
  Plotly.newPlot('fill-bar', [{
    x: filteredFacilities.map(f => f.display_name),
    y: filteredFacilities.map(f => f[fillKey]),
    type: 'bar',
    marker: { color: '#766CDB' },
    text: filteredFacilities.map(f => f[fillKey].toFixed(1) + '%'),
    textposition: 'auto',
    hoverinfo: 'y+text',
  }], {
    yaxis: { range: [0, 100], title: 'Fill Rate (%)', tickfont: {size: 12} },
    margin: { l:40, r:10, t:30, b:60 },
    height: 220,
    showlegend: false
  }, {displayModeBar: false});

  // Bar: Empty Miles
  const emptyKey = scenario === 'current' ? 'current_empty_miles' : 'zeus_empty_miles';
  Plotly.newPlot('empty-bar', [{
    x: filteredFacilities.map(f => f.display_name),
    y: filteredFacilities.map(f => f[emptyKey]),
    type: 'bar',
    marker: { color: '#DA847C' },
    text: filteredFacilities.map(f => f[emptyKey].toFixed(1) + '%'),
    textposition: 'auto',
    hoverinfo: 'y+text',
  }], {
    yaxis: { range: [0, 25], title: 'Empty Miles (%)', tickfont: {size: 12} },
    margin: { l:40, r:10, t:30, b:60 },
    height: 220,
    showlegend: false
  }, {displayModeBar: false});

  // KPI Table
  let tableHtml = `<table class='table table-striped'><thead><tr><th>Facility</th><th>Region</th><th>Sq Ft</th><th>Weekly Shipments</th><th>Fill Rate (${scenario === 'current' ? 'Current' : 'Zeus'})</th><th>Empty Miles (${scenario === 'current' ? 'Current' : 'Zeus'})</th><th>Trailers/Week</th><th>Annual Savings</th></tr></thead><tbody>`;
  filteredFacilities.forEach(f => {
    tableHtml += `<tr><td>${f.display_name}</td><td>${f.region}</td><td>${f.sqft.toLocaleString()}</td><td>${f.weekly_shipments.toLocaleString()}</td><td>${(scenario === 'current' ? f.current_fill_rate : f.zeus_fill_rate).toFixed(1)}%</td><td>${(scenario === 'current' ? f.current_empty_miles : f.zeus_empty_miles).toFixed(1)}%</td><td>${(scenario === 'current' ? f.current_trailers : f.zeus_trailers)}</td><td>$${f.annual_savings ? f.annual_savings.toLocaleString() : '-'}</td></tr>`;
  });
  tableHtml += '</tbody></table>';
  document.getElementById('kpi-table').innerHTML = tableHtml;
}

// Initialize
populateDropdowns();
setupEvents();
updateDashboard();
</script>
</body>
</HTML>